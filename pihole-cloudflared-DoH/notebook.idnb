{"cells":[{"kind":1,"language":"markdown","value":"## Pi-hole with cloudflared DoH (DNS-Over-HTTPS)\n\nThis example provides a base setup for using [Pi-hole](https://docs.pi-hole.net/) with the [cloudflared DoH](https://docs.pi-hole.net/guides/dns/cloudflared/) service.\nMore details on how to customize the installation and the compose file can be found in [Docker Pi-hole documentation](https://github.com/pi-hole/docker-pi-hole).\n\nProject structure:\n\n```\n.\n├── .env\n├── compose.yaml\n└── README.md\n\n```\n\n\n\n[*compose.yaml*](compose.yaml)"},{"kind":2,"language":"dockercompose","value":""},{"kind":1,"language":"markdown","value":"## Configuration\n\n### .env\n\nBefore deploying this setup, you need to configure the following values in the [.env](.env) file.\n\n* TZ ([time zone](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones))\n* PIHOLE_PW (admin password)\n* PIHOLE_ROUTER_IP (only needed for activated conditional forwarding)\n* PIHOLE_NETWORK_DOMAIN (only needed for activated conditional forwarding)\n* PIHOLE_HOST_IP (IPv4 address of your Pi-hole - needs to be static)\n* PIHOLE_HOST_IPV6 (IPv6 address of your Pi-hole - can be empty if you only use IPv4)\n\n\n### Conditional forwarding (optional, default: enabled)\n\nIf you would like to disable conditional forwarding, delete the environment variables starting with \"CONDITIONAL_FORWARDING\"\n\n### Container DNS (optional, default: disabled)\n\nIn the docker compose file, dns is added as a comment. To enable dns remove '#' in front of the following lines:"},{"kind":2,"language":"shellscript","value":""},{"kind":1,"language":"markdown","value":"## Deploy with docker compose\n\nWhen deploying this setup, the admin web interface will be available on port 8080 (e.g. [http://localhost:8080/admin](http://localhost:8080/admin))."},{"kind":2,"language":"shellscript","value":"docker compose up -d"},{"kind":1,"language":"markdown","value":"## Expected result\n\nCheck containers are running and the port mapping:"},{"kind":2,"language":"shellscript","value":"docker ps"},{"kind":1,"language":"markdown","value":"Navigate to `http://localhost:8080` in your web browser to access the installed Pi-hole web interface.\n\nStop the containers with"},{"kind":2,"language":"shellscript","value":"docker compose down\ndocker compose down -v"},{"kind":1,"language":"markdown","value":"## Troubleshooting\n\n### - Starting / Stopping pihole-FTL loop:\n\nSometimes, it can happen that there occurs a problem starting pihole-FTL.\nI personally had this issue when adding this line to the shared volumes:"},{"kind":2,"language":"shellscript","value":""},{"kind":1,"language":"markdown","value":"To fix this issue, I found this [issue](https://github.com/pi-hole/docker-pi-hole/issues/645#issuecomment-670809672),\nwhich suggested adding an empty file (`touch /pihole/pihole.log`) to prevent it from creating a directory.\nThe directory would not allow starting pihole-FTL and result in something like this:"},{"kind":2,"language":"shellscript","value":""},{"kind":1,"language":"markdown","value":"If you created an empty file, you may also check the ownership to prevent permission problems.\n\n### - Installing on Ubuntu may conflict with `systemd-resolved` - see [Installing on Ubuntu](https://github.com/pi-hole/docker-pi-hole#installing-on-ubuntu-or-fedora) for help.\n\n### - Environment variables are version-dependent\n\nEnvironment variables like \"CONDIIONAL_FORWARDING*\" and \"DNS1\" are deprecated and replaced by e.g. \"REV_SERVER*\" and \"PIHOLE_DNS\" in version 5.8+.\nCurrent information about environment variables can be found here: [https://github.com/pi-hole/docker-pi-hole](https://github.com/pi-hole/docker-pi-hole)"}]}